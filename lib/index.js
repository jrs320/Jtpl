module.exports=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$dom=t.transformListItem=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=u(i(4)),a=i(1),o=u(a),l=i(2);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var f=(function(e,t,i){t&&r(e.prototype,t),i&&r(e,i)}(h,[{key:"mounted",value:function(){this.$el=(0,o.default)("*["+this.mId+"]"),this.renderDone(),this.data.$el=this.$el,delete this.parsedHtml;try{this.c_mounted()}catch(e){console.error(e)}}},{key:"renderDone",value:function(){var e=this.transformResult,t=e.needInitViews,i=e.childJtpls,n=e.refs,r=e.events;for(var s in i)i[s].mounted();for(var a in this.childJtpls=Object.assign(this.childJtpls,i),n){var o=n[a];this.refs[a]=o instanceof h?o:this.$el.find("*["+o+"]").el}this._bind(r),this.events=this.events.concat(r),t.forEach(function(e){var t=e.view,i=e.prefix;t.update(i)}),this.transformResult={needInitViews:[],childJtpls:{},refs:{},events:[]}}},{key:"render",value:function(e){return(0,o.default)(e).html(this.parsedHtml),this.mounted(),this}},{key:"append",value:function(e){var t=(0,o.default)(e),i=document.createElement("div");return i.innerHTML=this.parsedHtml,t.el.appendChild(i.children[0]),i.removeChild(),this.mounted(),this}},{key:"$emit",value:function(e){var t=this.definedEvents[e];if(t){if(t=this.superJtpl[t]){for(var i=arguments.length,n=Array(1<i?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];t.apply(this.superJtpl,n)}}else console.error('event "'+e+'" is not defined')}},{key:"remove",value:function(){this._destory()}},{key:"_wrappData",value:function(e){var t=this.data,i=this.mvvm,n=e.methods,r=e.computed,s=e.watch;for(var a in t.refs=this.refs,this.c_mounted=this.c_mounted.bind(t),n)this[a]=n[a].bind(t),t[a]=this[a];t.$emit=this.$emit.bind(this),i.addWatch(s),i.addComputed(r)}},{key:"_bind",value:function(e){var t=this;(e=e||this.events).forEach(function(e){var i=e.targetId,n=e.tagName,r=e.eventName,s=e.eventFn,a=(0,o.default)(n+"["+i+"]"),l=s;"function"!=typeof l?"function"==typeof(l=t[s.name])&&(s.params?s.bindFn=function(e){l.apply(void 0,c(s.params).concat([e]))}:s.bindFn=l,a.on(r,s.bindFn)):a.on(r,l)})}},{key:"_unBind",value:function(e){(e=e||this.events).forEach(function(e){var t=e.targetId,i=e.tagName,n=e.eventName,r=e.eventFn,s=(0,o.default)(i+"["+t+"]"),a=r;"function"!=typeof a&&(a=r.bindFn),s.off(n,a)})}},{key:"_destory",value:function(){for(var e in this.childJtpls)this.childJtpls[e]._destory();this._unbind(),this.mId=null,this.tpl=null,(0,l.destroy)(this.data),this.data=null,(0,l.destroy)(this.components),this.components=null,this.c_mounted=null,(0,l.destroy)(this.refs),this.refs=null,(0,l.destroy)(this.childJtpls),this.childJtpls=null,(0,l.destroy)(this.events),this.events=null,(0,l.destroy)(this.temp),this.temp=null,this.$el.remove(),this.mvvm._destory()}}]),h);function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof h))throw new TypeError("Cannot call a class as a function")}(this),t=Object.assign({components:{},data:function(){return{}},computed:{},created:function(){},mounted:function(){},methods:{},watch:{}},t),this.mId=i.mId||j(),this.superJtpl=i.superJtpl,this.definedEvents=i.definedEvents,this.name=t.name,this.scope=t.scope,this.tpl=t.tpl,this.rootTagName=t.rootTagName,this.components=t.components,this.c_mounted=t.mounted,this.c_created=t.created;var n=e.props;delete e.props,this.data=Object.assign({},t.data(),e);var r=t.props;if(Array.isArray(r)){for(var a in n)r.includes(a)||delete n[a];Object.assign(this.data,n)}this.mvvm=new s.default(this.data,this),this.slots={},this.refs={},this.childJtpls={},this.events=[],this.temp={},this.transformResult={needInitViews:[],childJtpls:{},refs:{},events:[]},this._wrappData(t),this.parsedHtml=m(this);try{this.c_created.bind(this.data)()}catch(e){console.error(e)}}function v(e,t,i){var n=e.temp,r=e.mvvm;i.shouldDel=!1;var s=_();i=Object.assign({},i,{vId:s,mId:i.mId?j():void 0,domViewId:s});var a=N(s);(n.domHtmls[a]=i).listItemVs&&i.listItemVs.forEach(function(e,t){n.listItems[t]&&n.listItems[t].field==e.field||(n.listItems[t]=r._getListItems([i.listItemVs[t]])[0])}),n.listItems.push(t);var o={field:t.field,vId:i.mId||s,itemName:t.itemName,indexName:t.indexName},l=[o];i.listItemVs&&(l=[].concat(c(i.listItemVs),c(l)));var u=y(e,a,l);return n.listItems.pop(),{vId:o.vId,parsedHtml:u}}var m=function(e){var t=e.temp={execFields:new Set,domHtmls:{},expression:{},data:e.data,wrappData:{},dataVars:null,isTraning:!1,listItems:[]};t.wrappData=b.call(t,(0,l.clone)(e.data),[]);var i=e.tpl;i=(i=i.replace(/<!--\s+[\s\S]*?-->/g,"")).replace(/\{\{\s*(.*?)\s*\}\}/g,function(e,i){var n=k();return t.expression[n]=i,n});var n=p(e,i);for(var r in t.domHtmls){var s=t.domHtmls[r];if(s.shouldDel){for(var a in s)delete s[a];delete t.domHtmls[r]}}return n},p=function e(t,i){var n=t.components,r=t.temp.domHtmls,s=!1;return i=i.replace(/<([A-Z|a-z|\-|\d]+)([^>]*?)(?:(?:\/>)|(?:>([^<]*)<\/\1>))/g,function(e,t,i,a){s=!0;var o=_(),l=N(o),u={vId:o,tagName:t,attr:i||"",content:a||""},d=u.tagName.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}),c=n[d]||n[u.tagName];return c&&(u.mId=j(),u.component=c),r[l]=u,l}),s?e(t,i):y(t,i)},y=function e(t,i,n){var r=t.mId,s=t.temp,a=s.domHtmls,o=!1;return i=i.replace(/\[#(view)?\d+?#\]/g,function(e){var i=a[e];if(i){if(o=!0,n){var l=n[n.length-1],u=i.mId||i.vId;if(l.vId!==u){i.shouldDel=!1,i=Object.assign({},i,{vId:_(),mId:i.mId?j():void 0});var d=N(i.vId);a[d]=i}i.listItemVs=n}i.shouldDel=!0;var c=i.mId?w(t,i):g(t,i);return s.isTraning||(s.isTraning=!0,c=c.replace(/(<[A-Z|a-z|\-|\d]+)/,"$1 "+r)),c}return e}),o?e(t,i,n):i},g=function(e,t){e.data;var i=e.mvvm,n=e.temp,r=e.transformResult.events,s=t.domViewId||"",o=/\[!\d+?!\]/g;if("slot"===t.tagName){var l=t.attr.match(/name=(['"])([\s\S]+?)\1/),u=l?l[2]:"default";return E(u)}var d=void 0;if(t.attr=t.attr.replace(/(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\3/g,function(e,t,i,n,r){return"j-for"===t?(d=r,""):e}),d){var f=I(e,{key:"j-for",value:d,dom:t});if(f.success)return f.result}t.attr=t.attr.replace(/@(([a-z]|[A-Z]|_|\$|\d)*)=(['"])(.*?)\3/g,function(e,i,a,o,l){s=t.vId;var u=(l||"").match(/\s*([^\(]*)(?:\(([^\)]*)\))?/);return u&&r.push({targetId:t.vId,tagName:t.tagName,eventName:i,eventFn:{name:u[1],params:u[2]?u[2].split(",").map(function(e){return V(e.trim(),n)}):null}}),""});var h=new Set,v=[];return t.attr=t.attr.replace(/(\:)?(([a-z]|[A-Z]|_|\-|\$|\d)+)=((['"])([\s\S]+?)\5)/g,function(i,r,a,l,u,d,f){if(!r){var m=a,p=f;if("ref"===m){var y=x();return e.transformResult.refs[p]=y}if(/^j\-/.test(m)){var g=I(e,{key:m,value:p,dom:t});return g.success&&(s=t.vId),g.result}return i}var w=a,b=f,j=u,_=new Set;return j=j.replace(o,function(e){var t=n.expression[e];if(t){var i=V(t,n);return _=new Set([].concat(c(_),c(n.execFields))),i}return e}),0<_.size&&(v.push({fields:_,attrName:w,attrContent:b.replace(o,function(e){var t=n.expression[e];return t?"{{"+t+"}}":e})}),h=new Set([].concat(c(h),c(_)))),w+"="+j+" "}),0<h.size&&(s=t.vId,i.addView({vId:t.vId,type:"attr",tagName:t.tagName,fields:h,attributes:v,listItemVs:t.listItemVs})),t.content=t.content.replace(o,function(e){var r=n.expression[e];if(r){var s=V(r,n),o=_();return 0<n.execFields.size&&i.addView({vId:o,type:"content",tagName:a.modelTagName,fields:n.execFields,content:r,listItemVs:t.listItemVs}),"<"+a.modelTagName+" "+o+">"+s+"</"+a.modelTagName+">"}return e}),"<"+t.tagName+" "+s+" "+e.scope+" "+t.attr+">\n    "+t.content+"\n  </"+t.tagName+">"},w=function(e,t){var i=e.mvvm,n=e.temp,r=e.transformResult,s=r.childJtpls,a=r.needInitViews,o=t.component,l=t.mId,u=void 0;if(t.attr=t.attr.replace(/(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\3/g,function(e,t,i,n,r){return"j-for"===t?(u=r,""):e}),u){var d=I(e,{key:"j-for",value:u,dom:t});if(d.success)return d.result}var c={};t.attr=t.attr.replace(/@(([a-z]|[A-Z]|_|\$|\d)*)=(['"])(.*?)\3/g,function(e,t,i,n,r){var s=r;return c[t]=s,""});var f={},h=void 0;t.attr.replace(/(\:)?(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\4/g,function(e,r,s,o,u,d){var c=s,v=d;if(r){var m=V(v,n);f[c]=m}else if("ref"===c)h=v;else if(/^j\-show$/.test(c)){V(v,n);var p=n.execFields,y=i.addView({vId:l,type:"j-show",tagName:"*",fields:p,content:v,listItemVs:t.listItemVs});a.push({prefix:"",view:y})}else f[c]=v});var v=o.create({props:f},{mId:l,superJtpl:e,definedEvents:c});s[l]=v,h&&(e.transformResult.refs[h]=v);var m=function(e,t,i){var n=e.temp.domHtmls,r={};return i.content.replace(/\[#(view)?\d+?#\]/g,function(t){var i=n[t];if(i&&"template"===i.tagName){var s=i.attr.match(/slot=(['"])([\s\S]+?)\1/),a=s?s[2]:"default";r[a]=y(e,i.content,i.listItemVs)}}),r}(e,v.data,t);return v.parsedHtml=v.parsedHtml.replace(/\[@(.*)@\]/g,function(e,t){return t in m?m[t]:""}),v.parsedHtml},I=function(e,t){var i=e.mvvm,n=e.temp,r=e.transformResult,s=r.needInitViews,o=r.events,u=t.key,d=t.value,f=t.dom,h=f.vId,m=f.tagName,p=f.listItemVs,y=u.match(/^j\-([^\s]+)/),g={success:!1,result:""};if(!y)return g;var w=y[1];if("model"===w){if(!["input","select","textarea"].includes(m))return g;var I=V(d,n),b=n.execFields;"input"===m&&(g={success:!0,result:'value="'+I+'"'},o.push({targetId:h,tagName:m,eventName:"input",eventFn:function(t){(0,l.fieldData)(e.data,[].concat(c(b))[0],this.value)}})),i.addView({vId:h,type:"j-model",tagName:m,fields:b,content:d,listItemVs:p})}else if("show"===w){V(d,n);var j=n.execFields;g={success:!0,result:""};var x=i.addView({vId:h,type:"j-show",tagName:m,fields:j,content:d,listItemVs:p});s.push({prefix:"",view:x})}else if("for"===w){var k=d.split(" in ");2!==k.length&&console.error('j-for directive syntax error, eg: j-for="(item index) in data"');var N=k[0],E=k[1],F="index",S=N.match(/^\s*\((.*),(.*)\)/);S&&(N=S[1].trim(),F=S[2].trim());var O=V(E,n),A=[].concat(c(n.execFields))[0];Array.isArray(O)||console.error("j-for directive only usefull for array data");var D=_(),$=[],H=["<"+a.modelTagName+" "+D+"></"+a.modelTagName+">"];0<O.length&&O.forEach(function(t,i){var n=v(e,{field:A,itemName:N,item:t,indexName:F,index:i},f),r=n.vId,s=n.parsedHtml;$.push(r),H.push(s)}),g={success:!0,result:H.join("")},f.shouldDel=!1,i.addList({emptyVid:D,listViewIds:$,dom:f,listItem:{field:A,itemName:N,indexName:F}})}return g},b=function e(t){function i(i){if(!t.hasOwnProperty(i))return{v:void 0};var o=t[i],l=[].concat(c(r));s||l.push(i),o&&"object"===(void 0===o?"undefined":n(o))&&e.call(a,o,l),Array.isArray(o)?(t[i].__jkey__=i,t[i].toString=function(){return a.execFields.add(l.join()),"[object Array]"}):o&&"object"===(void 0===o?"undefined":n(o))?(t[i].__jkey__=i,t[i].toString=function(){return a.execFields.add(l.join()),"[object Object]"}):t[i]={__jkey__:i,toString:function(){return s||a.execFields.add(l.join()),"function"==typeof o&&(o="[object Function]"),o}}}var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],s=arguments[2],a=this;for(var o in t){var l=i(o);if("object"===(void 0===l?"undefined":n(l)))return l.v}return t},V=function(e,t){t.execFields=new Set;var i=t.dataVars,n=t.data,r=t.wrappData,s=t.listItems;i=i||(t.dataVars=Object.keys(r).map(function(e){return"var "+e+' = data["'+e+'"] \n'}));var a=[],o=s.map(function(e,i){var n,r=e.field,s=e.itemName,o=e.item,u=e.indexName,c=e.index,f=[r+","+c],h=b.call(t,(d(n={},s,(0,l.clone)(o)),d(n,u,c),n),f,!0);return a=a.concat(Object.keys(h).map(function(e){return"var "+e+" = listItem["+i+']["'+e+'"] \n'})),h}),u=void 0,f=i.join("")+a.join(""),h=" \n    var result = "+(e=""===e?"''":e)+"\n    if (result && result.__jkey__){\n      return result.toString()\n    }\n    return result\n  ";try{if(u=new Function("data, listItem",f+h)(r,o),/^\[object/.test(u)){var v=[].concat(c(t.execFields))[0];u=(0,l.fieldData)(n,v)}}catch(i){u=e,console.error("expression '"+e+"' parse error,"+i)}return u},j=function(){return"module"+F()},_=function(){return"view"+F()},x=function(){return"ref"+F()},k=function(){return"[!"+F()+"!]"},N=function(e){return"[#"+(e||F())+"#]"},E=function(e){return"[@"+e+"@]"},F=function(){return Math.floor(1e8*Math.random())};f.load=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.el,i=e.tpl;e.global,t?i?i.create().render(t):console.error("'tpl' property must be setted, it's a Jtpl instance"):console.error("'el' property must be setted, it's a css selector")},t.default=f,t.transformListItem=v,t.$dom=o.default},function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,i){t&&n(e.prototype,t)}(s,[{key:"find",value:function(e){if(this.el)return new s(this.el.querySelector(e))}},{key:"on",value:function(e,t){if(this.el)return this.el.addEventListener(e,t),this}},{key:"off",value:function(e,t){if(this.el)return this.el.removeEventListener(e,t),this}},{key:"insertAfter",value:function(e){if(e){var t=(e=e instanceof s?e.el:e).parentNode;t.lastChild===e?t.appendChild(this.el):t.insertBefore(this.el,e.nextSibling)}}},{key:"insertBefore",value:function(e){e&&(e=e instanceof s?e.el:e).parentNode.insertBefore(this.el,e)}},{key:"attr",value:function(e,t){if(this.el)return 1<arguments.length?(this.el.setAttribute(e,t),this):this.el.getAttribute(e)}},{key:"html",value:function(e){this.el&&(this.el.innerHTML=e)}},{key:"val",value:function(e){this.el&&(this.el.innerText=e)}},{key:"remove",value:function(){this.el&&(this.el.parentNode.removeChild(this.el),this.el=null,this[0]=null)}}]),s);function s(e){!function(e,t){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this.el=this[0]=e instanceof HTMLElement==1||e instanceof DocumentFragment==1?e:document.querySelector(e)}t.default=function(e){return new r(e)},t.modelTagName="j",t.on=function(e,t,i){e instanceof r?e.on(t,i):e.addEventListener(t,i)},t.off=function(e,t,i){e instanceof r?e.on(t,i):e.removeEventListener(t,i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e){var t=JSON.stringify(e,function(e,t){return"function"==typeof t?"#fn#"+t.toString():t});return JSON.parse(t,function(e,t){var i=t,n=void 0,r=new RegExp("^#fn#");if(r.test(i)){i=i.replace(r,""),/^\s*function/.test(i)||/^[^\{]*=>/.test(i)||(i="function "+i);try{n=new Function("","return "+i)()}catch(e){n=t}return n}return i})};t.fieldData=function(e,t,i){for(var n=e,s="string"==typeof t?t.split(","):r(t);1<s.length;)n=n[s.shift()];return 2<arguments.length&&(n[s[0]]=i),n[s[0]]},t.clone=r,t.destroy=function e(t){if("object"===(void 0===t?"undefined":n(t)))for(var i in t)"object"===n(t[i])&&e(t[i]),delete t[i]}},function(e,t,i){e.exports=i(0)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.execExpression=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&s(e.prototype,t),i&&s(e,i),e};function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=d(i(1)),o=i(0),l=d(o),u=i(2);function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var v=(r(m,[{key:"_observer",value:function(e,t,i){var r=this;if(e){i=i||Object.keys(e);for(var s=function(s){var a,o=i[s],u=e[o];if(u instanceof l.default||!e.hasOwnProperty(o))return"continue";a=u,Object.defineProperty(e,[o],{configurable:!0,enumerable:!0,get:function(){return j.add([].concat(f(t),[o]).join()),a},set:function(e){if(a!==e){var i=a;a=e,r._setValue(o,e,i,t)}}}),"object"===(void 0===u?"undefined":n(u))&&(r._observer(u,[].concat(f(t),[o])),Array.isArray(u)&&r._observerList(u,[].concat(f(t),[o])))},a=0;a<i.length;a++)s(a)}}},{key:"_observerList",value:function(e,t){var i=this;["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(n){var r=e[n];e[n]=function(){var e=[].concat(Array.prototype.slice.call(arguments));if(["push","pop"].includes(n)){var s=i.lists[t.join()];return s&&s.forEach(function(t){t[n].apply(t,e)}),r.apply(this,e)}var a=r.apply(this,e);return(0,u.fieldData)(i.data,t.join(),(0,u.clone)(this)),a}})}},{key:"_setValue",value:function(e,t,i,r){var s=this.fieldForVids,a=this.views,o=this.computed,l=[].concat(f(r),[e]);if("object"===(void 0===t?"undefined":n(t))&&(this._observer(t,l),Array.isArray(t))){this._observerList(t,l);var u=this.lists[[].concat(f(r),[e]).join()];u&&u.forEach(function(e){e.update(t)})}var d=new Set;for(var c in s)new RegExp("^"+l.join()).test(c)&&s[c].forEach(function(e){a[e]&&d.add(e)});d.forEach(function(e){a[e].update(l.join())}),this._invokeWatchFn(e,t,i,r),Object.keys(o).forEach(function(e){var t=o[e];t.affectedFields.some(function(e){return new RegExp("^"+l.join()+",").test(e+",")})&&t.refresh()})}},{key:"addView",value:function(e){var t=this.views,i=this.fieldForVids,n=e.vId,r=e.fields,s=n+e.type,a=t[s]=new p(e,this);return r.forEach(function(e){var t=i[e];t?t.add(s):i[e]=new Set([s])}),a}},{key:"addList",value:function(e){var t=e.listItem.field,i=new w(e,this),n=this.lists[t];n?n.push(i):this.lists[t]=[i]}},{key:"addWatch",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},i=this.watches;for(var r in t){var s=t[r],a=void 0,o=!1;"function"==typeof s?a=s:"object"===(void 0===s?"undefined":n(s))&&(a=s.handler||Function,o=s.deep),r in i?i[r].push({handler:a,deep:o}):i[r]=[{handler:a,deep:o}]}}},{key:"addComputed",value:function(e){var t=this,i=0<arguments.length&&void 0!==e?e:{},n=this.data,r=this.computed;Object.keys(i).forEach(function(e){var s=i[e];"function"==typeof s&&(r[e]=new b(e,s.bind(n),t),Object.defineProperty(n,[e],{configurable:!0,enumerable:!0,get:function(){return j.add(e),r[e].get()},set:function(){console.warn("field '"+e+"' is only read")}}))})}},{key:"_getListItems",value:function(e){var t=this,i=[];return(e=e||[]).forEach(function(e){var n=e.field,r=e.vId,s=e.itemName,a=e.indexName,o=t.lists[n].find(function(e){return e.listViewIds.includes(r)});if(o){var l=o.listViewIds.indexOf(r),d=(0,u.fieldData)(t.data,n+","+l);i.push({field:n,itemName:s,indexName:a,item:d,index:l})}}),i}},{key:"_invokeWatchFn",value:function(e,t,i,n){var r=this.watches,s=this.data,a=[].concat(f(n),[e]).join(),o=new RegExp("^"+a+",");Object.keys(r).some(function(e){return new RegExp("^"+a).test(e.split(".").join())})&&Object.keys(r).forEach(function(e){var n=r[e];if(e=e.split(".").join(),o.test(e+",")){var l=e.replace(o,""),d=e===a?t:(0,u.fieldData)(t,l),c=e===a?i:(0,u.fieldData)(i,l);n.forEach(function(e){e.handler.bind(s)(d,c)})}var f=new RegExp("^"+e+",");if(f.test(a)){var h=(0,u.fieldData)(s,e),v=(0,u.clone)(h);(0,u.fieldData)(v,a.replace(f,""),i),n.forEach(function(e){e.deep&&e.handler.bind(s)(h,v)})}})}},{key:"_destory",value:function(){for(var e in this.data=null,this.views)this.views[e]._destory(),delete this.views[e];for(var t in this.fieldForVids)delete this.fieldForVids[t];this.fieldForVids=null,this.views=null,(0,u.destroy)(this.watches),this.watches=null}}]),m);function m(e,t){h(this,m),this.jtpl=t,this.data=e,this.lists={},this.views={},this.fieldForVids={},this.watches={},this.computed={},this._observer(e,[])}var p=(r(y,[{key:"update",value:function(e){var t=this,i=this.domV,n=this.vm,r=n.data;if(this.$el=(0,a.default)(i.tagName+"["+i.vId+"]"),this.$el.el){var s=n._getListItems(i.listItemVs);this.exprVars=[],new Set([].concat(f(i.fields)).map(function(e){return e.split(",")[0]})).forEach(function(e){t.exprVars.push("var "+e+' = data[0]["'+e+'"] \n')}),this.exprData=s.map(function(e){var t,i=e.itemName,n=e.indexName,r=e.item,s=e.index;return c(t={},i,r),c(t,n,s),t}),this.exprData.forEach(function(e,i){Object.keys(e).forEach(function(e){t.exprVars.push("var "+e+" = data["+(i+1)+']["'+e+'"] \n')})}),this.exprData.unshift(r),g[i.type].apply(this,[e])}else this._destory()}},{key:"isUpdateByArrayMethod",value:function(e){e=e.join();var t=this.domV,i=this.vm,n=!1;if(t.listItemVs)for(var r=function(r){var s=t.listItemVs[r],a=s.field,o=s.vId,l=(s.itemName,s.indexName,i.lists[a].find(function(e){return e.listViewIds.includes(o)}));if(l){var u=new RegExp("^("+a+",)(d+)"),d=e.match(u);if(d){var c=d[2],h=l.listViewIds.indexOf(o);if(h!==c)return n=!0,t.fields=new Set([].concat(f(domv.fields)).map(function(e){var t=i.fieldForVids[e];return t?t.add(viewId):i.fieldForVids[e]=new Set([viewId]),e.replace(u,"$1"+h)})),t.attributes.forEach(function(e){e.fields=new Set([].concat(f(e.fields)).map(function(e){return e.replace(u,"$1"+h)}))}),"break"}}},s=0;s<t.listItemVs.length&&"break"!==r(s);s++);return n}},{key:"_destory",value:function(){for(var e in this.domV)delete this.domV[e];delete this.vm.views[this.id],this.id=null,this.domV=null,this.vm=null,this.$el&&this.$el.remove()}}]),y);function y(e,t){h(this,y),this.id=e.vId+e.type,this.domV=e,this.$el=null,this.vm=t}var g={attr:function(e){var t=this,i=this.exprVars,n=this.exprData,r=this.domV,s=r.attributes,a=(r.content,/\{\{\s*(.*?)\s*\}\}/g);s.forEach(function(r){var s=r.fields,o=r.attrName,l=r.attrContent;[].concat(f(s)).some(function(t){return new RegExp("^"+e).test(t)})&&t.$el.attr(o,l.replace(a,function(e,t){return x(t,i,n)}))})},content:function(e){var t=this.domV,i=this.exprVars,n=this.exprData,r=this.$el,s=t.content,a=x(s,i,n);r.val(a)},"j-model":function(e){var t=this.domV,i=this.exprVars,n=this.exprData,r=this.$el,s=t.tagName,a=t.content,o=x(a,i,n);switch(s){case"input":r.el.value=o}},"j-show":function(e){var t=this.domV,i=this.exprVars,n=this.exprData,r=this.$el,s=t.content;if(x(s,i,n)){var a=r.attr("style");a&&(a=a.replace(/display\s*\:\s*none/g,""),r.attr("style",a))}else r.el.style.display="none"}},w=(r(I,[{key:"update",value:function(e){var t=this.vm,i=this.listItem,n=this.emptyVid;for(var r in t.lists)new RegExp("^"+i.field+",").test(r)&&(t.lists[r].forEach(function(e){e._destory()}),t.lists[r]=[]);var s=this._newItemViews(e),o=s.listViewIds,l=s.fragNode,u=(0,a.default)("*["+n).el;(0,a.default)(l).insertAfter(u),this.listViewIds.forEach(function(e){(0,a.default)("*["+e+"]").remove()}),this.listViewIds=o,t.jtpl.renderDone()}},{key:"push",value:function(){var e,t=this.vm,i=this.listItem,n=this.emptyVid,r=[].concat(Array.prototype.slice.call(arguments)),s=this.listViewIds.length,o=this._newItemViews(r,s),l=o.listViewIds,d=o.fragNode;if(!(l.length<1)){var c=(0,u.fieldData)(t.data,i.field);t._observer(c,i.field.split(","),Object.keys(r).map(function(e){return parseInt(e)+s}));var h=0===s?n:this.listViewIds[s-1],v=(0,a.default)("*["+h+"]").el;(0,a.default)(d).insertAfter(v),(e=this.listViewIds).push.apply(e,f(l)),t.jtpl.renderDone()}}},{key:"pop",value:function(){var e=this.listViewIds.pop();(0,a.default)("*["+e+"]").remove()}},{key:"shift",value:function(){var e=this.listViewIds.shift();(0,a.default)("*["+e+"]").remove()}},{key:"unshift",value:function(){var e,t=this.vm,i=this.listItem,n=this.emptyVid,r=[].concat(Array.prototype.slice.call(arguments)),s=(this.listViewIds.length,this._newItemViews(r)),o=s.listViewIds,l=s.fragNode;if(!(o.length<1)){var d=(0,u.fieldData)(t.data,i.field);t._observer(d,i.field.split(","),Object.keys(r));var c=(0,a.default)("*["+n+"]").el;(0,a.default)(l).insertAfter(c),(e=this.listViewIds).unshift.apply(e,f(o)),t.jtpl.renderDone()}}},{key:"splice",value:function(){var e=this.vm,t=this.listItem,i=(this.listViewIds,[].concat(Array.prototype.slice.call(arguments))),n=i[0],r=i[1],s=i.slice(2),o=this.listViewIds.length;if(n=n<0?0:o-1<n?o-1:n,0<s.length){var l,d=0<Object.keys(this.listViewIds).splice(n,r).length,c=this._newItemViews(s,n+ +d),h=c.listViewIds,v=c.fragNode,m=0===o?emptyVid:this.listViewIds[n],p=(0,a.default)("*["+m+"]").el;(0,a.default)(v).insertAfter(p);var y=(l=this.listViewIds).splice.apply(l,[n,r].concat(f(h))),g=(0,u.fieldData)(e.data,t.field);e._observer(g,t.field.split(","),Object.keys(s).map(function(e){return parseInt(e)+n+ +d})),y.forEach(function(e){(0,a.default)("*["+e+"]").remove()})}else this.listViewIds.splice(n,r).forEach(function(e){(0,a.default)("*["+e+"]").remove()})}},{key:"sort",value:function(e){this.listViewIds.sort(e)}},{key:"reverse",value:function(e){this.listViewIds.reverse(e)}},{key:"_newItemViews",value:function(e,t){var i=0<arguments.length&&void 0!==e?e:[],n=1<arguments.length&&void 0!==t?t:0,r=this.dom,s=this.listItem,a=this.vm,l=[],u=[];i.forEach(function(e,t){var i=Object.assign({item:e,index:t+n},s);a.jtpl.temp.listItems=[];var d=(0,o.transformListItem)(a.jtpl,i,r),c=d.vId,f=d.parsedHtml;l.push(c),u.push(f)});var d=document.createDocumentFragment();return u.forEach(function(e){var t=document.createElement("div");t.innerHTML=e,d.appendChild(t.children[0])}),{listViewIds:l,fragNode:d}}},{key:"_destory",value:function(){this.listViewIds.forEach(function(e){(0,a.default)("*["+e+"]").remove()}),this.dom=null,this.listItem=null,this.listViewIds=null,this.vm=null}}]),I);function I(e,t){h(this,I),this.dom=e.dom,this.emptyVid=e.emptyVid,this.listItem=e.listItem,this.listViewIds=e.listViewIds,this.vm=t}var b=(r(V,[{key:"get",value:function(){return this.isComputed||this._computed(),this.value}},{key:"refresh",value:function(){var e=this;this.isComputed||this._computed();var t=this.computedFn();t!==this.value&&function(){e.value=t;var i=e.vm,n=i.fieldForVids,r=i.views,s=new Set;for(var a in n)new RegExp("^"+e.field).test(a)&&n[a].forEach(function(e){r[e]&&s.add(e)});s.forEach(function(t){r[t].update(e.field)})}(),this.impactFields.forEach(function(e){e&&e.refresh()})}},{key:"_computed",value:function(){var e=this;j.start(),this.value=this.computedFn(),this.affectedFields=j.get(),this.affectedFields.forEach(function(t){var i=e.vm.computed[t];i&&i.impactFields.add(e.field)}),this.isComputed=!0}}]),V);function V(e,t,i){h(this,V),this.field=e,this.computedFn=t,this.vm=i,this.affectedFields=[],this.impactFields=new Set,this.value=void 0,this.isComputed=!1}var j=(r(_,[{key:"start",value:function(){return this.execFields.clear(),this.record=!0,this}},{key:"add",value:function(e){return this.record&&this.execFields.add(e),this}},{key:"get",value:function(){var e=[].concat(f(this.execFields));return this.execFields.clear(),this.record=!1,e}}]),new _);function _(){h(this,_),this.record=!1,this.execFields=new Set}var x=function(e,t,i){var n="return "+(e=""===e?"''":e),r=void 0;try{r=new Function("data",t.join("")+n)(i)}catch(t){r=e,console.error("expression '"+e+"' parse error,"+t)}return r};t.default=v,t.execExpression=x}]);