module.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$dom=t.transformListItem=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=u(n(4)),a=n(1),o=u(a),l=n(2);function u(e){return e&&e.__esModule?e:{default:e}}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var c=(function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(v,[{key:"mounted",value:function(){this.renderDone(),delete this.parsedHtml;try{this.c_mounted()}catch(e){console.error(e)}}},{key:"renderDone",value:function(){var e=this.transformResult,t=e.needInitViews,n=e.childJtpls,i=e.refs,r=e.events;for(var s in n)n[s].mounted();for(var a in this.childJtpls=Object.assign(this.childJtpls,n),this.$el=(0,o.default)("*["+this.mId+"]"),i){var l=i[a];this.refs[a]=l instanceof v?l:this.$el.find("*["+l+"]").el}this._bind(r),this.events=this.events.concat(r),t.forEach(function(e){var t=e.view,n=e.prefix;t.update(n)}),this.transformResult={needInitViews:[],childJtpls:{},refs:{},events:[]}}},{key:"render",value:function(e){return(0,o.default)(e).html(this.parsedHtml),this.mounted(),this}},{key:"append",value:function(e){var t=(0,o.default)(e),n=document.createElement("div");return n.innerHTML=this.parsedHtml,t.el.appendChild(n.children[0]),n.removeChild(),this.mounted(),this}},{key:"$emit",value:function(e){var t=this.definedEvents[e];if(t){if(t=this.superJtpl[t]){for(var n=arguments.length,i=Array(1<n?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];t.apply(this.superJtpl,i)}}else console.error('event "'+e+'" is not defined')}},{key:"remove",value:function(){this._destory()}},{key:"_bind",value:function(e){var t=this;(e=e||this.events).forEach(function(e){var n=e.targetId,i=e.tagName,r=e.eventName,s=e.eventFn,a=(0,o.default)(i+"["+n+"]"),l=s;"function"!=typeof l?"function"==typeof(l=t[s.name])&&(s.params?s.bindFn=function(e){l.apply(void 0,f(s.params).concat([e]))}:s.bindFn=l,a.on(r,s.bindFn)):a.on(r,l)})}},{key:"_unBind",value:function(e){(e=e||this.events).forEach(function(e){var t=e.targetId,n=e.tagName,i=e.eventName,r=e.eventFn,s=(0,o.default)(n+"["+t+"]"),a=r;"function"!=typeof a&&(a=r.bindFn),s.off(i,a)})}},{key:"_destory",value:function(){for(var e in this.childJtpls)this.childJtpls[e]._destory();this._unbind(),this.mId=null,this.tpl=null,(0,l.destroy)(this.data),this.data=null,(0,l.destroy)(this.components),this.components=null,this.c_mounted=null,(0,l.destroy)(this.refs),this.refs=null,(0,l.destroy)(this.childJtpls),this.childJtpls=null,(0,l.destroy)(this.events),this.events=null,(0,l.destroy)(this.temp),this.temp=null,this.$el.remove(),this.mvvm._destory()}}]),v);function v(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};for(var i in function(e,t){if(!(e instanceof v))throw new TypeError("Cannot call a class as a function")}(this),(t=Object.assign({components:{},data:function(){return{}},mounted:function(){},methods:{}},t)).methods)this[i]=t.methods[i].bind(this);this.mId=n.mId||j(),this.superJtpl=n.superJtpl,this.definedEvents=n.definedEvents,this.name=t.name,this.scope=t.scope,this.tpl=t.tpl,this.rootTagName=t.rootTagName,this.components=t.components,this.c_mounted=t.mounted;var r=e.props;delete e.props,this.data=Object.assign({},t.data.bind(this)(),e);var a=t.props;if(Array.isArray(a)){for(var o in r)a.includes(o)||delete r[o];Object.assign(this.data,r)}this.mvvm=new s.default(this.data,this),this.refs={},this.childJtpls={},this.events=[],this.temp={},this.transformResult={needInitViews:[],childJtpls:{},refs:{},events:[]},this.parsedHtml=h(this)}function m(e,t,n){var i=e.temp,r=e.mvvm;n.shouldDel=!1;var s=_();n=Object.assign({},n,{vId:s,mId:n.mId?j():void 0,domViewId:s});var a=k(s);(i.domHtmls[a]=n).listItemVs&&n.listItemVs.forEach(function(e,t){i.listItems[t]&&i.listItems[t].field==e.field||(i.listItems[t]=r._getListItems([n.listItemVs[t]])[0])}),i.listItems.push(t);var o={field:t.field,vId:n.mId||s,itemName:t.itemName,indexName:t.indexName},l=[o];n.listItemVs&&(l=[].concat(f(n.listItemVs),f(l)));var u=y(e,a,l);return i.listItems.pop(),{vId:o.vId,parsedHtml:u}}var h=function(e){var t=e.temp={execFields:new Set,domHtmls:{},expression:{},data:e.data,wrappData:{},dataVars:null,isTraning:!1,listItems:[]};t.wrappData=w.call(t,(0,l.clone)(e.data),[]);var n=e.tpl;n=(n=n.replace(/<!--\s+[\s\S]*?-->/g,"")).replace(/\{\{\s*(.*?)\s*\}\}/g,function(e,n){var i=N();return t.expression[i]=n,i});var i=p(e,n);for(var r in t.domHtmls){var s=t.domHtmls[r];if(s.shouldDel){for(var a in s)delete s[a];delete t.domHtmls[r]}}return i},p=function e(t,n){var i=t.components,r=t.temp.domHtmls,s=!1;return n=n.replace(/<([A-Z|a-z|\-|\d]+)([^>]*?)(?:(?:\/>)|(?:>([^<]*)<\/\1>))/g,function(e,t,n,a){s=!0;var o=_(),l=k(o),u={vId:o,tagName:t,attr:n||"",content:a||""},d=u.tagName.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()}),f=i[d]||i[u.tagName];return f&&(u.mId=j(),u.component=f),r[l]=u,l}),s?e(t,n):y(t,n)},y=function e(t,n,i){var r=t.mId,s=t.temp,a=s.domHtmls,o=!1;return n=n.replace(/\[#(view)?\d+?#\]/g,function(e){var n=a[e];if(n){if(o=!0,i){var l=i[i.length-1],u=n.mId||n.vId;if(l.vId!==u){n.shouldDel=!1,n=Object.assign({},n,{vId:_(),mId:n.mId?j():void 0});var d=k(n.vId);a[d]=n}n.listItemVs=i}n.shouldDel=!0;var f=n.mId?g(t,n):I(t,n);return s.isTraning||(s.isTraning=!0,f=f.replace(/(<[A-Z|a-z|\-|\d]+)/,"$1 "+r)),f}return e}),o?e(t,n,i):n},I=function(e,t){e.data;var n=e.mvvm,i=e.temp,r=e.transformResult.events,s=t.domViewId||"",o=/\[!\d+?!\]/g,l=void 0;if(t.attr=t.attr.replace(/(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\3/g,function(e,t,n,i,r){return"j-for"===t?(l=r,""):e}),l){var u=b(e,{key:"j-for",value:l,dom:t});if(u.success)return u.result}t.attr=t.attr.replace(/@(([a-z]|[A-Z]|_|\$|\d)*)=(['"])(.*?)\3/g,function(e,n,a,o,l){s=t.vId;var u=(l||"").match(/\s*([^\(]*)(?:\(([^\)]*)\))?/);return u&&r.push({targetId:t.vId,tagName:t.tagName,eventName:n,eventFn:{name:u[1],params:u[2]?u[2].split(",").map(function(e){return V(e.trim(),i)}):null}}),""});var d=new Set,c=[];return t.attr=t.attr.replace(/(\:)?(([a-z]|[A-Z]|_|\-|\$|\d)+)=((['"])([\s\S]+?)\5)/g,function(n,r,a,l,u,v,m){if(!r){var h=a,p=m;if("ref"===h){var y=x();return e.transformResult.refs[p]=y}if(/^j\-/.test(h)){var I=b(e,{key:h,value:p,dom:t});return I.success&&(s=t.vId),I.result}return n}var g=a,w=m,j=u,_=new Set;return j=j.replace(o,function(e){var t=i.expression[e];if(t){var n=V(t,i);return _=new Set([].concat(f(_),f(i.execFields))),n}return e}),0<_.size&&(c.push({fields:_,attrName:g,attrContent:w.replace(o,function(e){var t=i.expression[e];return t?"{{"+t+"}}":e})}),d=new Set([].concat(f(d),f(_)))),g+"="+j+" "}),0<d.size&&(s=t.vId,n.addView({vId:t.vId,type:"attr",tagName:t.tagName,fields:d,attributes:c,listItemVs:t.listItemVs})),t.content=t.content.replace(o,function(e){var r=i.expression[e];if(r){var s=V(r,i),o=_();return 0<i.execFields.size&&n.addView({vId:o,type:"content",tagName:a.modelTagName,fields:i.execFields,content:r,listItemVs:t.listItemVs}),"<"+a.modelTagName+" "+o+">"+s+"</"+a.modelTagName+">"}return e}),"<"+t.tagName+" "+s+" "+e.scope+" "+t.attr+">\n    "+t.content+"\n  </"+t.tagName+">"},g=function(e,t){var n=e.mvvm,i=e.temp,r=e.transformResult,s=r.childJtpls,a=r.needInitViews,o=t.component,l=t.mId,u=void 0;if(t.attr=t.attr.replace(/(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\3/g,function(e,t,n,i,r){return"j-for"===t?(u=r,""):e}),u){var d=b(e,{key:"j-for",value:u,dom:t});if(d.success)return d.result}var f={};t.attr=t.attr.replace(/@(([a-z]|[A-Z]|_|\$|\d)*)=(['"])(.*?)\3/g,function(e,t,n,i,r){var s=r;return f[t]=s,""});var c={},v=void 0;t.attr.replace(/(\:)?(([a-z]|[A-Z]|_|\-|\$|\d)+)=(['"])([\s\S]+?)\4/g,function(e,r,s,o,u,d){var f=s,m=d;if(r){var h=V(m,i);c[f]=h}else if("ref"===f)v=m;else if(/^j\-show$/.test(f)){V(m,i);var p=i.execFields,y=n.addView({vId:l,type:"j-show",tagName:"*",fields:p,content:m,listItemVs:t.listItemVs});a.push({prefix:"",view:y})}else c[f]=m});var m=o.create({props:c},{mId:l,superJtpl:e,definedEvents:f});return s[l]=m,v&&(e.transformResult.refs[v]=m),m.parsedHtml},b=function(e,t){var n=e.mvvm,i=e.temp,r=e.transformResult,s=r.needInitViews,o=r.events,u=t.key,d=t.value,c=t.dom,v=c.vId,h=c.tagName,p=c.listItemVs,y=u.match(/^j\-([^\s]+)/),I={success:!1,result:""};if(!y)return I;var g=y[1];if("model"===g){if(!["input","select","textarea"].includes(h))return I;var b=V(d,i),w=i.execFields;"input"===h&&(I={success:!0,result:'value="'+b+'"'},o.push({targetId:v,tagName:h,eventName:"input",eventFn:function(t){(0,l.fieldData)(e.data,[].concat(f(w))[0],this.value)}})),n.addView({vId:v,type:"j-model",tagName:h,fields:w,content:d,listItemVs:p})}else if("show"===g){V(d,i);var j=i.execFields;I={success:!0,result:""};var x=n.addView({vId:v,type:"j-show",tagName:h,fields:j,content:d,listItemVs:p});s.push({prefix:"",view:x})}else if("for"===g){var N=d.split(" in ");2!==N.length&&console.error('j-for directive syntax error, eg: j-for="(item index) in data"');var k=N[0],S=N[1],E="index",A=k.match(/^\s*\((.*),(.*)\)/);A&&(k=A[1].trim(),E=A[2].trim());var O=V(S,i),F=[].concat(f(i.execFields))[0];Array.isArray(O)||console.error("j-for directive only usefull for array data");var D=_(),$=[],T=["<"+a.modelTagName+" "+D+"></"+a.modelTagName+">"];0<O.length&&O.forEach(function(t,n){var i=m(e,{field:F,itemName:k,item:t,indexName:E,index:n},c),r=i.vId,s=i.parsedHtml;$.push(r),T.push(s)}),I={success:!0,result:T.join("")},c.shouldDel=!1,n.addList({emptyVid:D,listViewIds:$,dom:c,listItem:{field:F,itemName:k,indexName:E}})}return I},w=function e(t){function n(n){if(!t.hasOwnProperty(n))return{v:void 0};var o=t[n],l=[].concat(f(r));s||l.push(n),o&&"object"===(void 0===o?"undefined":i(o))&&e.call(a,o,l),Array.isArray(o)?(t[n].__jkey__=n,t[n].toString=function(){return a.execFields.add(l.join()),"[object Array]"}):o&&"object"===(void 0===o?"undefined":i(o))?(t[n].__jkey__=n,t[n].toString=function(){return a.execFields.add(l.join()),"[object Object]"}):t[n]={__jkey__:n,toString:function(){return s||a.execFields.add(l.join()),"function"==typeof o&&(o="[object Function]"),o}}}var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],s=arguments[2],a=this;for(var o in t){var l=n(o);if("object"===(void 0===l?"undefined":i(l)))return l.v}return t},V=function(e,t){t.execFields=new Set;var n=t.dataVars,i=t.data,r=t.wrappData,s=t.listItems;n=n||(t.dataVars=Object.keys(r).map(function(e){return"var "+e+' = data["'+e+'"] \n'}));var a=[],o=s.map(function(e,n){var i,r=e.field,s=e.itemName,o=e.item,u=e.indexName,f=e.index,c=[r+","+f],v=w.call(t,(d(i={},s,(0,l.clone)(o)),d(i,u,f),i),c,!0);return a=a.concat(Object.keys(v).map(function(e){return"var "+e+" = listItem["+n+']["'+e+'"] \n'})),v}),u=void 0,c=n.join("")+a.join(""),v=" \n    var result = "+(e=""===e?"''":e)+"\n    if (result && result.__jkey__){\n      return result.toString()\n    }\n    return result\n  ";try{if(u=new Function("data, listItem",c+v)(r,o),/^\[object/.test(u)){var m=[].concat(f(t.execFields))[0];u=(0,l.fieldData)(i,m)}}catch(n){u=e,console.error("expression '"+e+"' parse error,"+n)}return u},j=function(){return"module"+S()},_=function(){return"view"+S()},x=function(){return"ref"+S()},N=function(){return"[!"+S()+"!]"},k=function(e){return"[#"+(e||S())+"#]"},S=function(){return Math.floor(1e8*Math.random())};c.load=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.el,n=e.tpl;e.global,t?n?n.create().render(t):console.error("'tpl' property must be setted, it's a Jtpl instance"):console.error("'el' property must be setted, it's a css selector")},t.default=c,t.transformListItem=m,t.$dom=o.default},function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){t&&i(e.prototype,t)}(s,[{key:"find",value:function(e){if(this.el)return new s(this.el.querySelector(e))}},{key:"on",value:function(e,t){if(this.el)return this.el.addEventListener(e,t),this}},{key:"off",value:function(e,t){if(this.el)return this.el.removeEventListener(e,t),this}},{key:"insertAfter",value:function(e){if(e){var t=(e=e instanceof s?e.el:e).parentNode;t.lastChild===e?t.appendChild(this.el):t.insertBefore(this.el,e.nextSibling)}}},{key:"insertBefore",value:function(e){e&&(e=e instanceof s?e.el:e).parentNode.insertBefore(this.el,e)}},{key:"attr",value:function(e,t){if(this.el)return 1<arguments.length?(this.el.setAttribute(e,t),this):this.el.getAttribute(e)}},{key:"html",value:function(e){this.el&&(this.el.innerHTML=e)}},{key:"val",value:function(e){this.el&&(this.el.innerText=e)}},{key:"remove",value:function(){this.el&&(this.el.parentNode.removeChild(this.el),this.el=null,this[0]=null)}}]),s);function s(e){!function(e,t){if(!(e instanceof s))throw new TypeError("Cannot call a class as a function")}(this),this.el=this[0]=e instanceof HTMLElement==1||e instanceof DocumentFragment==1?e:document.querySelector(e)}t.default=function(e){return new r(e)},t.modelTagName="j",t.on=function(e,t,n){e instanceof r?e.on(t,n):e.addEventListener(t,n)},t.off=function(e,t,n){e instanceof r?e.on(t,n):e.removeEventListener(t,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.fieldData=function(e,t,n){for(var i=e,r=t.split(",");1<r.length;)i=i[r.shift()];return 2<arguments.length&&(i[r[0]]=n),i[r[0]]},t.clone=function(e){var t=JSON.stringify(e,function(e,t){return"function"==typeof t?"#fn#"+t.toString():t});return JSON.parse(t,function(e,t){var n=t,i=void 0,r=new RegExp("^#fn#");if(r.test(n)){n=n.replace(r,""),/^\s*function/.test(n)||/^[^\{]*=>/.test(n)||(n="function "+n);try{i=new Function("","return "+n)()}catch(e){i=t}return i}return n})},t.destroy=function e(t){if("object"===(void 0===t?"undefined":i(t)))for(var n in t)"object"===i(t[n])&&e(t[n]),delete t[n]}},function(e,t,n){e.exports=n(0)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.execExpression=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e};function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=d(n(1)),o=n(0),l=d(o),u=n(2);function d(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var m=(r(h,[{key:"_observer",value:function(e,t,n){var r=this;if(e){n=n||Object.keys(e);for(var s=function(s){var a,o=n[s],d=e[o];if(d instanceof l.default||!e.hasOwnProperty(o))return"continue";a=d,Object.defineProperty(e,[o],{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a!==e&&((0,u.destroy)(a),a=e,r._setValue(o,e,t))}}),"object"===(void 0===d?"undefined":i(d))&&(r._observer(d,[].concat(c(t),[o])),Array.isArray(d)&&r._observerList(d,[].concat(c(t),[o])))},a=0;a<n.length;a++)s(a)}}},{key:"_observerList",value:function(e,t){var n=this;["push","pop","shift","unshift","splice","sort","reverse"].forEach(function(i){var r=e[i];e[i]=function(){var e=[].concat(Array.prototype.slice.call(arguments));if(["push","pop"].includes(i)){var s=n.lists[t.join()];return s&&s.forEach(function(t){t[i].apply(t,e)}),r.apply(this,e)}var a=r.apply(this,e);return(0,u.fieldData)(n.data,t.join(),(0,u.clone)(this)),a}})}},{key:"_setValue",value:function(e,t,n){var r=this.fieldForVids,s=this.views,a=[].concat(c(n),[e]);if("object"===(void 0===t?"undefined":i(t))&&(this._observer(t,a),Array.isArray(t))){this._observerList(t,a);var o=this.lists[[].concat(c(n),[e]).join()];o&&o.forEach(function(e){e.update(t)})}var l=new Set;for(var u in r)new RegExp("^"+a.join()).test(u)&&r[u].forEach(function(e){s[e]&&l.add(e)});l.forEach(function(e){s[e].update(a.join())})}},{key:"addView",value:function(e){var t=this.views,n=this.fieldForVids,i=e.vId,r=e.fields,s=i+e.type,a=t[s]=new p(e,this);return r.forEach(function(e){var t=n[e];t?t.add(s):n[e]=new Set([s])}),a}},{key:"addList",value:function(e){var t=e.listItem.field,n=new g(e,this),i=this.lists[t];i?i.push(n):this.lists[t]=[n]}},{key:"_getListItems",value:function(e){var t=this,n=[];return(e=e||[]).forEach(function(e){var i=e.field,r=e.vId,s=e.itemName,a=e.indexName,o=t.lists[i].find(function(e){return e.listViewIds.includes(r)});if(o){var l=o.listViewIds.indexOf(r),d=(0,u.fieldData)(t.data,i+","+l);n.push({field:i,itemName:s,indexName:a,item:d,index:l})}}),n}},{key:"_destory",value:function(){for(var e in this.data=null,this.views)this.views[e]._destory(),delete this.views[e];for(var t in this.fieldForVids)delete this.fieldForVids[t];this.fieldForVids=null,this.views=null}}]),h);function h(e,t){v(this,h),this.jtpl=t,this.data=e,this.lists={},this.views={},this.fieldForVids={},this._observer(e,[])}var p=(r(y,[{key:"update",value:function(e){var t=this,n=this.domV,i=this.vm,r=i.data;if(this.$el=(0,a.default)(n.tagName+"["+n.vId+"]"),this.$el.el){var s=i._getListItems(n.listItemVs);this.exprVars=[],new Set([].concat(c(n.fields)).map(function(e){return e.split(",")[0]})).forEach(function(e){t.exprVars.push("var "+e+' = data[0]["'+e+'"] \n')}),this.exprData=s.map(function(e){var t,n=e.itemName,i=e.indexName,r=e.item,s=e.index;return f(t={},n,r),f(t,i,s),t}),this.exprData.forEach(function(e,n){Object.keys(e).forEach(function(e){t.exprVars.push("var "+e+" = data["+(n+1)+']["'+e+'"] \n')})}),this.exprData.unshift(r),I[n.type].apply(this,[e])}else this._destory()}},{key:"isUpdateByArrayMethod",value:function(e){e=e.join();var t=this.domV,n=this.vm,i=!1;if(t.listItemVs)for(var r=function(r){var s=t.listItemVs[r],a=s.field,o=s.vId,l=(s.itemName,s.indexName,n.lists[a].find(function(e){return e.listViewIds.includes(o)}));if(l){var u=new RegExp("^("+a+",)(d+)"),d=e.match(u);if(d){var f=d[2],v=l.listViewIds.indexOf(o);if(v!==f)return i=!0,t.fields=new Set([].concat(c(domv.fields)).map(function(e){var t=n.fieldForVids[e];return t?t.add(viewId):n.fieldForVids[e]=new Set([viewId]),e.replace(u,"$1"+v)})),t.attributes.forEach(function(e){e.fields=new Set([].concat(c(e.fields)).map(function(e){return e.replace(u,"$1"+v)}))}),"break"}}},s=0;s<t.listItemVs.length&&"break"!==r(s);s++);return i}},{key:"_destory",value:function(){for(var e in this.domV)delete this.domV[e];delete this.vm.views[this.id],this.id=null,this.domV=null,this.vm=null,this.$el&&this.$el.remove()}}]),y);function y(e,t){v(this,y),this.id=e.vId+e.type,this.domV=e,this.$el=null,this.vm=t}var I={attr:function(e){var t=this,n=this.exprVars,i=this.exprData,r=this.domV,s=r.attributes,a=(r.content,/\{\{\s*(.*?)\s*\}\}/g);s.forEach(function(r){var s=r.fields,o=r.attrName,l=r.attrContent;[].concat(c(s)).some(function(t){return new RegExp("^"+e).test(t)})&&t.$el.attr(o,l.replace(a,function(e,t){return w(t,n,i)}))})},content:function(e){var t=this.domV,n=this.exprVars,i=this.exprData,r=this.$el,s=t.content,a=w(s,n,i);r.val(a)},"j-model":function(e){var t=this.domV,n=this.exprVars,i=this.exprData,r=this.$el,s=t.tagName,a=t.content,o=w(a,n,i);switch(s){case"input":r.el.value=o}},"j-show":function(e){var t=this.domV,n=this.exprVars,i=this.exprData,r=this.$el,s=t.content;if(w(s,n,i)){var a=r.attr("style");a&&(a=a.replace(/display\s*\:\s*none/g,""),r.attr("style",a))}else r.el.style.display="none"}},g=(r(b,[{key:"update",value:function(e){var t=this.vm,n=this.listItem,i=this.emptyVid;for(var r in t.lists)new RegExp("^"+n.field+",").test(r)&&(t.lists[r].forEach(function(e){e._destory()}),t.lists[r]=[]);var s=this._newItemViews(e),o=s.listViewIds,l=s.fragNode,u=(0,a.default)("*["+i).el;(0,a.default)(l).insertAfter(u),this.listViewIds.forEach(function(e){(0,a.default)("*["+e+"]").remove()}),this.listViewIds=o,t.jtpl.renderDone()}},{key:"push",value:function(){var e,t=this.vm,n=this.listItem,i=this.emptyVid,r=[].concat(Array.prototype.slice.call(arguments)),s=this.listViewIds.length,o=this._newItemViews(r,s),l=o.listViewIds,d=o.fragNode;if(!(l.length<1)){var f=(0,u.fieldData)(t.data,n.field);t._observer(f,n.field.split(","),Object.keys(r).map(function(e){return parseInt(e)+s}));var v=0===s?i:this.listViewIds[s-1],m=(0,a.default)("*["+v+"]").el;(0,a.default)(d).insertAfter(m),(e=this.listViewIds).push.apply(e,c(l)),t.jtpl.renderDone()}}},{key:"pop",value:function(){var e=this.listViewIds.pop();(0,a.default)("*["+e+"]").remove()}},{key:"shift",value:function(){var e=this.listViewIds.shift();(0,a.default)("*["+e+"]").remove()}},{key:"unshift",value:function(){var e,t=this.vm,n=this.listItem,i=this.emptyVid,r=[].concat(Array.prototype.slice.call(arguments)),s=(this.listViewIds.length,this._newItemViews(r)),o=s.listViewIds,l=s.fragNode;if(!(o.length<1)){var d=(0,u.fieldData)(t.data,n.field);t._observer(d,n.field.split(","),Object.keys(r));var f=(0,a.default)("*["+i+"]").el;(0,a.default)(l).insertAfter(f),(e=this.listViewIds).unshift.apply(e,c(o)),t.jtpl.renderDone()}}},{key:"splice",value:function(){var e=this.vm,t=this.listItem,n=(this.listViewIds,[].concat(Array.prototype.slice.call(arguments))),i=n[0],r=n[1],s=n.slice(2),o=this.listViewIds.length;if(i=i<0?0:o-1<i?o-1:i,0<s.length){var l,d=0<Object.keys(this.listViewIds).splice(i,r).length,f=this._newItemViews(s,i+ +d),v=f.listViewIds,m=f.fragNode,h=0===o?emptyVid:this.listViewIds[i],p=(0,a.default)("*["+h+"]").el;(0,a.default)(m).insertAfter(p);var y=(l=this.listViewIds).splice.apply(l,[i,r].concat(c(v))),I=(0,u.fieldData)(e.data,t.field);e._observer(I,t.field.split(","),Object.keys(s).map(function(e){return parseInt(e)+i+ +d})),y.forEach(function(e){(0,a.default)("*["+e+"]").remove()})}else this.listViewIds.splice(i,r).forEach(function(e){(0,a.default)("*["+e+"]").remove()})}},{key:"sort",value:function(e){this.listViewIds.sort(e)}},{key:"reverse",value:function(e){this.listViewIds.reverse(e)}},{key:"_newItemViews",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:[],i=1<arguments.length&&void 0!==t?t:0,r=this.dom,s=this.listItem,a=this.vm,l=[],u=[];n.forEach(function(e,t){var n=Object.assign({item:e,index:t+i},s);a.jtpl.temp.listItems=[];var d=(0,o.transformListItem)(a.jtpl,n,r),f=d.vId,c=d.parsedHtml;l.push(f),u.push(c)});var d=document.createDocumentFragment();return u.forEach(function(e){var t=document.createElement("div");t.innerHTML=e,d.appendChild(t.children[0])}),{listViewIds:l,fragNode:d}}},{key:"_destory",value:function(){this.listViewIds.forEach(function(e){(0,a.default)("*["+e+"]").remove()}),this.dom=null,this.listItem=null,this.listViewIds=null,this.vm=null}}]),b);function b(e,t){v(this,b),this.dom=e.dom,this.emptyVid=e.emptyVid,this.listItem=e.listItem,this.listViewIds=e.listViewIds,this.vm=t}var w=function(e,t,n){var i="return "+(e=""===e?"''":e),r=void 0;try{r=new Function("data",t.join("")+i)(n)}catch(t){r=e,console.error("expression '"+e+"' parse error,"+t)}return r};t.default=m,t.execExpression=w}]);